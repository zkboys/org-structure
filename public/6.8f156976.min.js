webpackJsonp([6],{7:function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function a(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t["default"]=e,t}Object.defineProperty(t,"__esModule",{value:!0}),t.ValidationRule=t.TipMessage=t.Storage=t.Request=t.PubSubMsg=t.Cookie=t.Common=void 0;var o=n(10),i=a(o),l=n(13),s=r(l),u=n(8),d=r(u),c=n(9),f=r(c),p=n(18),h=r(p),m=n(3),y=r(m),g=n(11),b=r(g);t.Common=i,t.Cookie=s["default"],t.PubSubMsg=d["default"],t.Request=f["default"],t.Storage=h["default"],t.TipMessage=y["default"],t.ValidationRule=b["default"]},11:function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var a=n(3),o=r(a),i=n(4),l=r(i);t["default"]={required:function(e){return{required:!0,message:o["default"].canNotBeNull(e)}},loginName:function(e){return{validator:function(t,n,r){n&&!/^[a-zA-Z0-9\-_]+$/i.test(n)?r(new Error(e||o["default"].loginNameFormatError)):r()}}},checkLoginNameExist:function(){var e=arguments.length<=0||void 0===arguments[0]?[]:arguments[0];return"string"==typeof e&&(e=[e]),{validator:function(t,n,r){return!n||e.indexOf(n)>-1?r():void l["default"].get("/api/organization/users/loginname/"+n).end(function(e,t){return e||!t.ok?r([new Error(t&&t.body&&t.body.message||"未知系统错误")]):t.body&&n===t.body.loginname?r([new Error("抱歉，该登录名已被占用！")]):void r()})}}},checkRoleNameExist:function(){var e=arguments.length<=0||void 0===arguments[0]?[]:arguments[0];return"string"==typeof e&&(e=[e]),{validator:function(t,n,r){return!n||e.indexOf(n)>-1?r():void l["default"].get("/api/organization/users/loginname/"+n).end(function(e,t){return e||!t.ok?r([new Error(t&&t.body&&t.body.message||"未知系统错误")]):t.body&&n===t.body.loginname?r([new Error("抱歉，该登录名已被占用！")]):void r()})}}},mobile:function(e){return{validator:function(t,n,r){var a=/((\d{11})|^((\d{7,8})|(\d{4}|\d{3})-(\d{7,8})|(\d{4}|\d{3})-(\d{7,8})-(\d{4}|\d{3}|\d{2}|\d{1})|(\d{7,8})-(\d{4}|\d{3}|\d{2}|\d{1}))$)/;n&&!a.test(n)?r(new Error(e||o["default"].mobileFormatError)):r()}}},email:function(e){return{type:"email",message:e||o["default"].emailFormatError}}},e.exports=t["default"]},12:function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var l="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol?"symbol":typeof e},s=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),u=function E(e,t,n){null===e&&(e=Function.prototype);var r=Object.getOwnPropertyDescriptor(e,t);if(void 0===r){var a=Object.getPrototypeOf(e);return null===a?void 0:E(a,t,n)}if("value"in r)return r.value;var o=r.get;if(void 0!==o)return o.call(n)},d=n(1),c=r(d),f=n(2),p=n(17),h=n(21),m=n(19),y=r(m),g=n(8),b=r(g),v=function(e){function t(){var e,n,r,i;a(this,t);for(var l=arguments.length,s=Array(l),u=0;l>u;u++)s[u]=arguments[u];return n=r=o(this,(e=Object.getPrototypeOf(t)).call.apply(e,[this].concat(s))),r.state={pageHeader:"",showPageAnimate:y["default"].pageAnimate()},i=n,o(r,i)}return i(t,e),s(t,[{key:"getPageHeaderDateByMenu",value:function(){for(var e=(0,h.getCurrentSidebarMenu)(),t=e?e.parentText:[],n=e?e.text:"",r=[],a=0;a<t.length;a++)r.push({text:t[a]});return r.push({text:n}),{title:n,breadcrumbItems:r}}},{key:"setPageHeader",value:function(){var e="",t=null;if("auto"===this.props.header?t=this.getPageHeaderDateByMenu():"object"===l(this.props.header)&&(this.props.header.title||this.props.header.breadcrumbItems?(t={},"auto"===this.props.header.title?t.title=this.getPageHeaderDateByMenu().title:this.props.header.title?t.title=this.props.header.title:t.title=" ","auto"===this.props.header.breadcrumbItems?t.breadcrumbItems=this.getPageHeaderDateByMenu().breadcrumbItems:this.props.header.breadcrumbItems?t.breadcrumbItems=this.props.header.breadcrumbItems:t.breadcrumbItems=""):e=c["default"].createElement("div",{className:"admin-page-header"},this.props.header)),t){for(var n=[],r=t.breadcrumbItems,a=0;a<r.length;a++){var o=r[a],i="page-breadcrumb-item"+a;n.push(o.path?c["default"].createElement(f.Breadcrumb.Item,{key:i},c["default"].createElement(p.Link,{to:o.path},o.text)):c["default"].createElement(f.Breadcrumb.Item,{key:i},o.text))}var s="";t.breadcrumbItems&&(s=c["default"].createElement(f.Breadcrumb,null,n)),e=c["default"].createElement("div",{className:"admin-page-header"},c["default"].createElement("h1",{className:"admin-page-header-title"},t.title),s)}this.setState({pageHeader:e})}},{key:"componentWillMount",value:function(){}},{key:"componentDidMount",value:function(){var e=this;u(Object.getPrototypeOf(t.prototype),"componentDidMount",this)&&u(Object.getPrototypeOf(t.prototype),"componentDidMount",this).call(this),b["default"].subscribeOnceAcceptOldMsg("set-header-breadcrumb",function(){e.setPageHeader()})}},{key:"render",value:function(){var e=c["default"].createElement("div",null,this.state.pageHeader,this.props.children);return c["default"].createElement("div",{className:"admin-page "},c["default"].createElement(f.Spin,{spinning:this.props.loading},e))}}]),t}(c["default"].Component);v.defaultProps={loading:!1,animConfig:[{opacity:[1,0],translateY:[0,50]},{opacity:[1,0],translateY:[0,-50]}]},t["default"]=v,e.exports=t["default"]},13:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t["default"]={getCookie:function(e){for(var t=document.cookie.split("; "),n=0;n<t.length;n++){var r=t[n].split("=");if(r[0]===e)return unescape(r[1])}return""}},e.exports=t["default"]},15:function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var l=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),s=n(1),u=r(s),d=n(2),c=n(9),f=r(c),p=n(3),h=r(p),m=n(7),y=function(e){function t(){a(this,t);var e=o(this,Object.getPrototypeOf(t).call(this));return e.loadings=0,e.startLoading=function(){e.setState({loading:!0}),e.loadings++},e.endLoading=function(){e.loadings--,0===e.loadings&&e.setState({loading:!1})},e.requests=[],e.requestTimeouts=[],e.request=function(){var t=e;return{url:null,withNoMchId:!1,errorMsg:null,type:null,paramsData:{},withNoLoading:!1,startCb:null,errorCb:null,successCb:null,isEnd:!1,outTime:1e4,get:function(e){return this.url=e,this.type="get",this},post:function(e){return this.url=e,this.type="post",this},put:function(e){return this.url=e,this.type="put",this},del:function(e){return this.url=e,this.type="delete",this},params:function(e){return this.paramsData=e,this},timeout:function(e){this.outTime=e},noLoading:function(){return this.withNoLoading=!0,this},setErrorMsg:function(e){return this.errorMsg=h["default"][e],this},start:function(e){return this.startCb=e,this},error:function(e){return this.errorCb=e,this},success:function(e){return this.successCb=e,this},end:function(e){var n=this;if(!this.url)throw Error("request need a url!");var r=function(r,a){if(n.isEnd=!0,n.withNoLoading||t.endLoading(),r||!a.ok)n.errorCb?n.errorCb(r,a):String(r).indexOf("the network is offline")>-1?d.message.error("网络异常，请检查您得网络！",1):d.message.error(n.errorMsg||a&&a.body&&a.body.message||"未知系统错误",1);else{if("text/html"===a.type)throw Error("The url maybe invalid!");n.successCb&&n.successCb(a.body||a,a)}e&&e(r,a)};this.startCb&&this.startCb(),this.withNoLoading||t.startLoading(),this.isEnd=!1;var a=void 0,o=setTimeout(function(){if(!n.isEnd&&a){var e="请求超时，请检查您的网络",t=new Error("timeout"),o={body:{message:e}};r(t,o),a.abort()}},this.outTime);return t.requestTimeouts.push(o),a="get"===this.type?f["default"].get(this.url).query(this.paramsData).end(r):"put"===this.type?f["default"].put(this.url).send(this.paramsData).end(r):"delete"===this.type?f["default"].del(this.url).send(this.paramsData).end(r):f["default"].post(this.url).send(this.paramsData).end(r),t.requests.push(a),this}}},e.currentUser=m.Storage.session.get("currentLoginUser"),e.currentUser.hasPermission=function(t){var n=e.currentUser.permissions;return n&&n.indexOf(t)>-1},e}return i(t,e),l(t,[{key:"componentWillUnmount",value:function(){this.requests.forEach(function(e){e.abort()}),this.requestTimeouts.forEach(function(e){e&&clearTimeout(e)})}}]),t}(u["default"].Component);t["default"]=y,e.exports=t["default"]},32:function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0}),t.Page=void 0;var a=n(12),o=r(a);t.Page=o["default"]},99:function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function a(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function l(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var s=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},u=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),d=n(1),c=r(d),f=n(2),p=n(15),h=r(p),m=n(14),y=r(m),g=n(7),b=n(32),v=g.Common.convertToTree,E=f.Tree.TreeNode,k=f.Form.create,w=f.Form.Item,O=function(e){function t(){var e,n,r,l;o(this,t);for(var s=arguments.length,u=Array(s),d=0;s>d;d++)u[d]=arguments[d];return n=r=i(this,(e=Object.getPrototypeOf(t)).call.apply(e,[this].concat(u))),r.state={showModal:!1,organizations:[],gData:[],disableEditRemark:!1,disableEditKey:!0,expandedKeys:[],isAddTopOrg:!1},r.onDragEnter=function(e){console.log(e)},r.findNodeByKey=function(e,t,n){e.forEach(function(e,a,o){return e.key===t?n(e,a,o):e.children?r.findNodeByKey(e.children,t,n):void 0})},r.onDrop=function(e){var t=e.node.props.eventKey,n=e.dragNode.props.eventKey,o=[].concat(a(r.state.gData)),i=void 0;if(r.findNodeByKey(o,n,function(e,t,n){n.splice(t,1),i=e}),e.dropToGap){var l=void 0,s=void 0;r.findNodeByKey(o,t,function(e,t,n){i.parentKey=e.parentKey,l=n,s=t}),l.splice(s,0,i)}else r.findNodeByKey(o,t,function(e){e.children=e.children||[],i.parentKey=e.key,e.children.push(i)});r.setState({gData:o})},r.handleTreeNodeClick=function(e){var t=[].concat(a(r.state.gData)),n=e[0],o=void 0;if(r.findNodeByKey(t,n,function(e){o=e}),o){var i=r.props.form.setFieldsValue;r.setState({disableEditRemark:o.children&&o.children.length&&o.parentKey}),i({key:o.key,text:o.text,remark:o.remark,description:o.description})}},r.handleRightClick=function(e){console.log(e.node.props.eventKey)},r.handleReset=function(e){e.preventDefault(),r.props.form.resetFields(),r.setState({gData:v(r.state.organizations)})},r.handleSubmit=function(e){e.preventDefault(),r.props.form.validateFields(["key","text","description","remark"],function(e,t){if(!e){var n=[].concat(a(r.state.gData));r.findNodeByKey(n,t.key,function(e){e.remark=t.remark,e.description=t.description,e.text=t.text}),r.setState({gData:n})}})},r.handleSave=function(){var e=[].concat(a(r.state.gData)),t=[],n=function o(e){return e.forEach(function(e){t.push({key:e.key,parentKey:e.parentKey,name:e.text,description:e.description,remark:e.remark}),e.children&&e.children.length&&o(e.children)})};n(e),console.log(t),r.request().post("/organization/organizations").params({organizations:t}).success(function(){f.message.success("保存成功"),r.setState({organizations:t})}).end()},r.handleDelete=function(){r.props.form.validateFields(["key"],function(e,t){if(!e){var n=t.key,o=[].concat(a(r.state.gData)),i=function l(e){e.forEach(function(e,t,r){e.key===n&&r.splice(t,1),e.children&&e.children.length&&l(e.children)})};i(o),r.setState({gData:o}),r.props.form.resetFields()}})},r.handleAddTopOrg=function(){var e=r.props.form.setFieldsValue;e({newText:"",newRemark:"",newDescription:""}),r.setState({isAddTopOrg:!0}),r.showModal()},r.handleAddChild=function(){r.props.form.validateFields(["key","text"],function(e){if(e)return void f.message.info("请先选择一个组织");var t=r.props.form.setFieldsValue;t({newText:"",newRemark:"",newDescription:""}),r.setState({isAddTopOrg:!1}),r.showModal()})},r.handleModalOk=function(){r.props.form.validateFields(["newText","newDescription","newRemark"],function(e,t){if(!e){var n=[].concat(a(r.state.gData)),o=r.props.form.getFieldValue("key"),i={parentKey:o,key:String((new Date).getTime()),text:t.newText,description:t.newDescription,remark:t.newRemark};r.state.isAddTopOrg?(i.parentKey=void 0,n.push(i)):r.findNodeByKey(n,o,function(e){e.children||(e.children=[]),e.children.push(i)}),r.setState({gData:n}),r.hideModal()}})},r.showModal=function(){r.setState({showModal:!0})},r.hideModal=function(){r.setState({showModal:!1})},l=n,i(r,l)}return l(t,e),u(t,[{key:"componentDidMount",value:function(){var e=this;this.request().get("/organization/organizations").success(function(t){if(t&&t.length){var n=t.map(function(e){return e.text=e.name,e});e.setState({organizations:n,gData:v(n)})}}).end()}},{key:"render",value:function(){var e=this,t=function k(e){return e.map(function(e){return e.children&&e.children.length?c["default"].createElement(E,{key:e.key,title:c["default"].createElement("span",null,c["default"].createElement(y["default"],{type:e.description})," ",e.text)},k(e.children)):c["default"].createElement(E,{key:e.key,title:c["default"].createElement("span",null,c["default"].createElement(y["default"],{type:e.description})," ",e.text)})})},n=this.props.form.getFieldProps,r={rules:[{required:!0,message:"key 不能为空！"}]},a={rules:[{required:!0,min:2,message:"标题至少为 2 个字符"}]},o={rules:[]},i={rules:[]},l=n("key",r),u=n("text",a),d=n("newText",a),p=n("description",o),h=n("newDescription",o),m=n("remark",i),g=n("newRemark",i);this.state.disableEditRemark&&(m.disabled=!0),this.state.disableEditKey&&(l.disabled=!0);var v={labelCol:{span:4},wrapperCol:{span:10}};return c["default"].createElement(b.Page,{header:"auto",loading:this.state.loading},c["default"].createElement(f.Row,null,c["default"].createElement(f.Col,{span:12,style:{textAlign:"right"}},c["default"].createElement("div",{style:{textAlign:"left",display:"inline-block"}},c["default"].createElement("div",{style:{marginBottom:"10px"}},c["default"].createElement(f.Button,{type:"primary",size:"large",onClick:this.handleAddTopOrg},"添加顶级组织"),"   ",c["default"].createElement(f.Button,{type:"primary",size:"large",onClick:this.handleSave},"保存"),"   ",c["default"].createElement(f.Button,{type:"ghost",size:"large",onClick:this.handleReset},"重置")),c["default"].createElement(f.Tree,{defaultExpandAll:!0,defaultExpandedKeys:this.state.expandedKeys,openAnimation:{},draggable:!0,onDragEnter:this.onDragEnter,onDrop:this.onDrop,onSelect:this.handleTreeNodeClick},t(this.state.gData)))),c["default"].createElement(f.Col,{span:12},c["default"].createElement(f.Form,{horizontal:!0,form:this.props.form},c["default"].createElement(w,{wrapperCol:{span:20,offset:4}},c["default"].createElement(f.Button,{type:"primary",onClick:this.handleDelete},"删除"),"   ",c["default"].createElement(f.Button,{type:"ghost",onClick:this.handleAddChild},"添加子节点")),c["default"].createElement(w,s({},v,{label:"key：",hasFeedback:!0,style:{display:"none"}}),c["default"].createElement(f.Input,s({},l,{onChange:function(t){l.onChange(t),e.handleSubmit(t)},placeholder:"唯一不可重复。"}))),c["default"].createElement(w,s({},v,{label:"名称：",hasFeedback:!0}),c["default"].createElement(f.Input,s({},u,{onChange:function(t){u.onChange(t),e.handleSubmit(t)},placeholder:"请输入组织名称"}))),c["default"].createElement(w,s({},v,{label:"描述：",hasFeedback:!0}),c["default"].createElement(f.Input,s({},p,{onChange:function(t){p.onChange(t),e.handleSubmit(t)},placeholder:"请输入组织描述"}))),c["default"].createElement(w,s({},v,{label:"备注：",hasFeedback:!0}),c["default"].createElement(f.Input,s({},m,{onChange:function(t){m.onChange(t),e.handleSubmit(t)},placeholder:"请输入备注"})))))),c["default"].createElement(f.Modal,{title:"添加子组织",visible:this.state.showModal,onOk:this.handleModalOk,onCancel:this.hideModal},c["default"].createElement(f.Form,{horizontal:!0,form:this.props.form},c["default"].createElement(w,s({},v,{label:"名称：",hasFeedback:!0}),c["default"].createElement(f.Input,s({},d,{placeholder:"请输入组织名称"}))),c["default"].createElement(w,s({},v,{label:"描述：",hasFeedback:!0}),c["default"].createElement(f.Input,s({},h,{placeholder:"请输入组织描述"}))),c["default"].createElement(w,s({},v,{label:"备注：",hasFeedback:!0}),c["default"].createElement(f.Input,s({},g,{placeholder:"请输入备注"}))))))}}]),t}(h["default"]);t["default"]=k()(O),e.exports=t["default"]}});